# 第五章

## 习题

### 5.1 说明主存储器的组成，并比较 SRAM 和 DRAM 有何不同之处？为什么 DRAM 的地址线比 SRAM 的地址线少？为什么 DRAM 的地址一般要分两次接受？

主存储器由存储单元组成，每个存储单元有一个唯一的地址，用于存储一个字节的数据。SRAM 和 DRAM 的不同之处在于，SRAM 是静态存储器，DRAM 是动态存储器。SRAM 的地址线比 DRAM 的地址线多，是因为 SRAM 的地址线是直接连接到存储单元的，而 DRAM 的地址线是连接到存储单元的地址译码器的，所以 DRAM 的地址线比 SRAM 的地址线少。DRAM 的地址一般要分两次接受，是因为 DRAM 的地址线是连接到存储单元的地址译码器的，所以要分两次接受。

### 5.2 有一个 64K×16 位的存储器，由 16K×1 位的 DRAM 芯片（芯片内是 128×128 结构）构成，存储器读/写周期为 500ns，问：

（1）需要多少片 DRAM 芯片？
（2）采用异步刷新方式，如单元刷新间隔不超过 2ms，则刷新信号周期是多少？
（3）如果用集中刷新方式，存储器刷新一遍最少用多少时间？

#### （1）需要多少片 DRAM 芯片？

首先，明确目标是构建一个 64K×16 位的存储器。这意味着存储器总共有 64K（即 64×1024）个地址，每个地址可以存储 16 位数据。而我们有的是 16K×1 位的 DRAM 芯片，每片芯片有 16K（即 16×1024）个地址，每个地址可以存储 1 位数据。

由于我们的目标存储器是 16 位宽的，而每个 DRAM 芯片只能存储 1 位数据，因此我们需要 16 片 DRAM 芯片来组成一个 16 位宽的存储器。但是，每片 DRAM 芯片的地址数量只有 16K，而我们需要 64K 的地址空间。所以，我们还需要更多的 DRAM 芯片来增加地址空间。

要达到 64K 的地址空间，我们需要把 16K 的地址空间扩展到 64K，即需要 4 倍的地址空间。所以，总共需要 16 片（构成 16 位宽度）× 4（扩展地址空间）= 64 片 DRAM 芯片。

#### （2）采用异步刷新方式，如单元刷新间隔不超过 2ms，则刷新信号周期是多少？

DRAM 芯片需要定期刷新以保持数据。题目中提到，芯片内是 128×128 结构，这意味着有 128 行需要被刷新。在异步刷新方式中，每个刷新周期刷新一行。

如果单元刷新间隔不超过 2ms，我们需要在 2ms 内完成所有 128 行的刷新。因此，刷新每行的时间是 2ms 除以 128 行，即：

刷新信号周期 = $\frac{2ms}{128}$

我们可以计算出具体的时间值。

#### （3）如果用集中刷新方式，存储器刷新一遍最少用多少时间？

在集中刷新方式中，所有行都会在一个刷新周期内被连续刷新。题目提到存储器读/写周期为 500ns。这通常也是 DRAM 刷新一个行所需的最小时间。

所以，刷新所有 128 行所需的最少时间是 128 行乘以每行刷新所需的时间，即：

总刷新时间 = $128 行 × 500ns$

现在我们来计算这两个问题的具体数值。

#### 计算结果：

1. **需要的 DRAM 芯片数量：** 64 片。

2. **异步刷新方式下的刷新信号周期：** 刷新信号周期为 15625 纳秒（ns）。

3. **集中刷新方式下存储器刷新一遍最少用的时间：** 总刷新时间为 64000 纳秒（ns）。

#### 异步刷新

异步刷新方式下的刷新信号周期可以通过以下公式计算：

刷新信号周期 = $\frac{总刷新间隔}{行数}$

在这个情况下：

- **总刷新间隔**是指在达到最大间隔时间（例如 2ms）之前需要完成一次完整的刷新周期。这是 DRAM 芯片的要求，用来保证数据不会因为失去电荷而丢失。
- **行数**是 DRAM 芯片中的行数。对于一个 128×128 结构的 DRAM，就有 128 行。

所以，具体到这个问题中，刷新信号周期计算如下：

刷新信号周期 = $\frac{2ms}{128}$
这表示在 2ms 内，每行需要被刷新的时间间隔。由于刷新是周期性的，这个值代表了每次刷新信号之间的平均时间间隔。

#### 集中刷新

在集中刷新方式（也称为全面刷新或突发刷新）中，存储器的所有行会在一个短暂的时间窗口内连续刷新。这通常在一个固定的刷新周期内完成。集中刷新的总时间可以通过以下公式计算：

总刷新时间 = $行数 × 每行刷新时间$

对于这个特定的问题：

- **行数**同样是 DRAM 芯片中的行数，即 128 行。
- **每行刷新时间**通常等同于存储器的读/写周期，因为这通常是刷新一个行所需的最小时间。在这个问题中，存储器的读/写周期为 500 纳秒。

因此，集中刷新方式下存储器刷新一遍最少用的时间计算如下：

总刷新时间 = $128行 × 500ns$

这意味着在这段时间内，存储器会暂停正常的读/写操作以完成刷新过程。

### 5.3 某机字长 16 位，CPU 地址总线 18 位，数据总线 16 位，存储器按字编址，CPU 的控制信号线有：MREQ#（存储器访问请求，低电平有效），R/W#（读写控制，低电平为写信号，高电平为读信号）。试问：

- （1）该机可以配备的最大主存容量为 。
- （2）该机主存采用 64K×1bit 的 DRAM 芯片（内部为 4 个 128×128 阵列）构成最大主存空间，则共需 个芯片；若采用异步刷新方式，单元刷新间隔为 2ms，则刷新信号的周期为 。
- （3）若为该机配备 2K×16 位的 Cache，每块 8 字节，采用 2 路组相联映象，试写出对主存地址各个字段的划分（标出各个字段的位数）；若主存地址为 462EH，则该地址可映象到 Cache 的哪一组？
- （4）已知该机已有 8K×16 位的 ROM 存储器，地址处于主存的最高端；现在再用若干个 16K×8 位的 SRAM 芯片形成 128K×16 位的 RAM 存储区域，起始地址为 00000H，假设 SRAM 芯片有 CS#（片选，低电平有效）和 WE#（写使能，低电平有效）信号控制端；试写出 RAM、ROM 的地址范围，并画出 SRAM、ROM 与 CPU 的连接图，请标明 SRAM 芯片个数、译码器的输入输出线、地址线、数据线、控制线及其连接。

#### （1）该机可以配备的最大主存容量？

**该机可以配备的最大主存容量：** 524288 字节（即 512KB）。

- **CPU 地址总线位数：** 18 位。地址总线的位数决定了 CPU 能够寻址的最大内存空间。每条地址线可以寻址两个状态（0 或 1），所以总寻址能力是 $2^{地址总线位数}$。
- **存储器按字编址：** 每个地址指向一个 16 位（2 字节）的字。

所以，最大主存容量计算公式为：

$最大主存容量 = 2^{地址总线位数} × 字长$

$最大主存容量 = 2^{18} × 2 \text{ 字节}$

#### （2）构成最大主存空间的 DRAM 芯片数量和刷新信号周期

- **主存采用 64K×1bit 的 DRAM 芯片：** 每片芯片有 64K 个地址，每个地址存储 1 位数据。
- **机字长 16 位：** 意味着需要 16 个这样的芯片来构成 16 位数据宽度。
- **CPU 地址总线 18 位：** 需要确保地址空间与 CPU 的寻址能力相匹配。
- **异步刷新方式，单元刷新间隔为 2ms：** 每个 DRAM 芯片的内部为 4 个 128×128 阵列，所以总共有 512 行（128 行 ×4 阵列）需要刷新,但是实际上是四个阵列同时刷新，所以只需要 128 行刷新。刷新信号周期为 15625 纳秒（ns）。

所需芯片数计算公式为：

$芯片数 = \frac{最大主存容量}{单片芯片容量}$
$芯片数 = \frac{2^{18} × 2 \text{ 字节}}{64K × 1 \text{ 位}}$

刷新信号周期计算为：

$刷新信号周期 = \frac{2ms}{128 行}$

**构成最大主存空间的 DRAM 芯片数量：** 64 片。

**刷新信号周期：** 15625 纳秒（ns）。

#### 若为该机配备 2K×16 位的 Cache，每块 8 字节，采用 2 路组相联映象，试写出对主存地址各个字段的划分（标出各个字段的位数）；若主存地址为 462EH，则该地址可映象到 Cache 的哪一组？


1. **机器的基本参数**：
   - 字长：16位
   - CPU地址总线：18位
   - 数据总线：16位
   - 存储器按字编址

2. **Cache的参数**：
   - 大小：2K×16位
   - 每块大小：8字节
   - 映射方式：2路组相联映射

3. **地址字段划分**：
   - **总线宽度与地址空间**：CPU的地址总线为18位，所以地址空间是 $2^{18}$字节。
   - **存储器按字编址**：由于每个字16位（2字节），因此总的字地址空间是 $2^{18} / 2 = 2^{17}$字。
   - **Cache的大小**：2K×16位意味着共有 $2K = 2048$个字，即2048个16位的存储单元。
   - **Cache的块大小**：每块8字节，即4字，因为每个字是2字节。

4. **计算Cache参数**：
   - **块数（Block Count）**：Cache总大小除以每块大小，即 $2048 \text{ 字} / 4 \text{ 字/块} = 512 \text{ 块}$。
   - **组数（Set Count）**：由于采用2路组相联映射，所以组数是块数除以2，即 $512 \text{ 块} / 2 = 256 \text{ 组}$。

5. **地址字段划分**：
   - **标记（Tag）**：剩余的位数用于标记。地址总线宽度为18位，故标记位数 = 18 - 组索引位数 - 块内偏移位数 = 18 - 8 - 2 = 8位。
   - **组索引（Set Index）**：组数为256，需要 $log_2(256) = 8$位来表示组索引。
   - **块内偏移（Block Offset）**：每块有4个字，需要 $log_2(4) = 2$位来表示块内偏移。

6. **主存地址462EH映射到Cache的组**：
   - 将主存地址转换为二进制：462EH = 00 0100 0110 0010 1110（二进制）
   - 
   - 根据上述划分，地址的最低2位是块内偏移，接下来的8位是组索引，剩余的8位是标记。
   - 组索引：从右到左数，第3位到第10位，即10 0010 11 
   - 1000 1011 = 8B（十六进制） = 139（十进制）
综上所述，主存地址462EH可映射到Cache的第139组。